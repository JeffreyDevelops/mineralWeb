<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/94/three.min.js" integrity="sha256-NGC9JEuTWN4GhTj091wctgjzftr+8WNDmw0H8J5YPYE=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/InventivetalentDev/MineRender@1.4.6/dist/skin.min.js"></script>
</head>
<body>

    <% if (push_player.includes(parameter) === true) { %>
    
        <h1><%=parameter%></h1>

        <script>
            
            var skinRender = new SkinRender({
                autoResize: false,
                render: {
                    taa: true
                },
                camera: {               // Camera position
                    x: 1,
                    y: 25,
                    z: 50,
                    target: [0, 0, 0]   // Where the camera should look
                },
                canvas: {
                    width: 300,
                    height: 600
                },
            }, document.body);
            skinRender.render({
                username: location.hash ? location.hash.substring(1) : "<%=UUID_player%>",
                capeUrl: "https://minerender.org/img/optifine_cape.png",
                optifine: true
            });
            if (location.hash) $("#nameInput").val(location.hash.substring(1));
            $("#nameInput,#capeInput,#slim").on("change", function () {
                skinRender.clearScene();
                var skin = $("#nameInput").val();
                var cape = $("#capeInput").val();
                var slim =  $("#slim").is(":checked");
                var options = {};
                if (skin.indexOf("http") === 0) {
                    options.url = skin;
                } else {
                    options.username = skin;
                    location.hash = skin;
                }
                if (cape && cape.length > 0) {
                    if (cape.includes("capes.dev") || !cape.startsWith("http")) { // capes.dev link or type
                        options.cape = cape;
                    } else {
                        options.capeUrl = cape;
                        options.optifine = cape.toLowerCase().indexOf("optifine") > 0;
                    }
                }
                options.slim = slim;
                skinRender.render(options);
            })

            $(".partToggle").on("change", function () {
                skinRender.getModelByName($(this).attr("id")).visible = $(this).is(":checked");
            });

            var animate = true;
            $("#animate").on("change", function () {
                animate = $(this).is(":checked");
            });



            var startTime = Date.now();
            document.body.addEventListener("skinRender", function (e) {
                if (animate) {
                    var t = (Date.now() - startTime) / 1000;
                    e.detail.playerModel.children[2].rotation.x = Math.sin(t * 5) / 2;
                    e.detail.playerModel.children[3].rotation.x = -Math.sin(t * 5) / 2;
                    e.detail.playerModel.children[4].rotation.x = Math.sin(t * 5) / 2;
                    e.detail.playerModel.children[5].rotation.x = -Math.sin(t * 5) / 2;
                }
            })
        
        </script>

        <% } %>
        

</body>
</html>